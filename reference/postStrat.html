<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Compute a post-stratified estimator — postStrat • mase</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Compute a post-stratified estimator — postStrat"><meta name="description" content="Calculates a post-stratified estimator for a finite population mean/proportion or total based on sample data collected from a complex sampling design and a single, categorical auxiliary population variable."><meta property="og:description" content="Calculates a post-stratified estimator for a finite population mean/proportion or total based on sample data collected from a complex sampling design and a single, categorical auxiliary population variable."><meta property="og:image" content="https://mcconvil.github.io/mase/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">mase</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.5.900</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mcconvil/mase/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Compute a post-stratified estimator</h1>
      <small class="dont-index">Source: <a href="https://github.com/mcconvil/mase/blob/master/R/postStrat.R" class="external-link"><code>R/postStrat.R</code></a></small>
      <div class="d-none name"><code>postStrat.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculates a post-stratified estimator for a finite population mean/proportion or total based on sample data collected from a complex sampling design and a single, categorical auxiliary population variable.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">postStrat</span><span class="op">(</span></span>
<span>  <span class="va">y</span>,</span>
<span>  <span class="va">xsample</span>,</span>
<span>  <span class="va">xpop</span>,</span>
<span>  pi <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  N <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  var_est <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  var_method <span class="op">=</span> <span class="st">"LinHB"</span>,</span>
<span>  pi2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  datatype <span class="op">=</span> <span class="st">"raw"</span>,</span>
<span>  B <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  fpc <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  messages <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-y">y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A numeric vector of the sampled response variable.</p></dd>


<dt id="arg-xsample">xsample<a class="anchor" aria-label="anchor" href="#arg-xsample"></a></dt>
<dd><p>A vector containing the post-stratum for each sampled unit.</p></dd>


<dt id="arg-xpop">xpop<a class="anchor" aria-label="anchor" href="#arg-xpop"></a></dt>
<dd><p>A vector or data frame, depending on datatype.  If datatype = "raw", then a vector containing the post-stratum for each population unit.  If datatype = "totals" or "means", then a data frame, where the first column lists the possible post-strata and the second column contains the population total or proportion in each post-stratum.</p></dd>


<dt id="arg-pi">pi<a class="anchor" aria-label="anchor" href="#arg-pi"></a></dt>
<dd><p>A numeric vector of inclusion probabilities for each sampled unit in y.  If NULL, then simple random sampling without replacement is assumed.</p></dd>


<dt id="arg-n">N<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>A numeric value of the population size. If NULL, it is estimated with the sum of the inverse of the pis.</p></dd>


<dt id="arg-var-est">var_est<a class="anchor" aria-label="anchor" href="#arg-var-est"></a></dt>
<dd><p>Default to FALSE, logical for whether or not to compute estimate of variance</p></dd>


<dt id="arg-var-method">var_method<a class="anchor" aria-label="anchor" href="#arg-var-method"></a></dt>
<dd><p>The method to use when computing the variance estimator.  Options are a Taylor linearized technique: "LinHB"= Hajek-Berger estimator, "LinHH" = Hansen-Hurwitz estimator, "LinHTSRS" = Horvitz-Thompson estimator under simple random sampling without replacement, and "LinHT" = Horvitz-Thompson estimator or a resampling technique: "bootstrapSRS" = bootstrap variance estimator under simple random sampling without replacement, "SRSunconditional" = simple random sampling variance estimator which accounts for random strata.</p></dd>


<dt id="arg-pi-">pi2<a class="anchor" aria-label="anchor" href="#arg-pi-"></a></dt>
<dd><p>A square matrix of the joint inclusion probabilities.  Needed for the "LinHT" variance estimator.</p></dd>


<dt id="arg-datatype">datatype<a class="anchor" aria-label="anchor" href="#arg-datatype"></a></dt>
<dd><p>Default to "raw", takes values "raw", "totals" or "means" for whether the user is providing the raw population stratum memberships, the population totals of each stratum, or the population proportions of each stratum.</p></dd>


<dt id="arg-b">B<a class="anchor" aria-label="anchor" href="#arg-b"></a></dt>
<dd><p>The number of bootstrap samples if computing the bootstrap variance estimator.  Default is 1000.</p></dd>


<dt id="arg-fpc">fpc<a class="anchor" aria-label="anchor" href="#arg-fpc"></a></dt>
<dd><p>Default to TRUE, logical for whether or not the variance calculation should include a finite population correction when calculating the "LinHTSRS", "SRSunconditional", or the "SRSbootstrap" variance estimator.</p></dd>


<dt id="arg-messages">messages<a class="anchor" aria-label="anchor" href="#arg-messages"></a></dt>
<dd><p>A logical indicating whether to output the messages internal to mase. Default is TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list of output containing:</p>
<p>* pop_total: Estimate of population total.</p>
<p>* pop_mean: Estimate of the population mean (or proportion).</p>
<p>* pop_total_var: Estimated variance of population total estimate.</p>
<p>* pop_mean_var: Estimated variance of population mean estimate.</p>
<p>* strat_ests: Table of total and mean estimates for each strata.</p>
<p>* weights: Survey weights produced by PS.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Cochran W~G (1977).
<em>Sampling Techniques</em>, 3rd edition.
John Wiley &amp; Sons, New York.</p>
<p>Sarndal C~E, Swensson B, Wretman J (1992).
<em>Model Assisted Survey Sampling</em>.
Springer-Verlag, New York.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">IdahoPop</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">IdahoSamp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xsample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">IdahoSamp</span>, <span class="va">COUNTYFIPS</span> <span class="op">==</span> <span class="st">"16055"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xpop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">IdahoPop</span>, <span class="va">COUNTYFIPS</span> <span class="op">==</span> <span class="st">"16055"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="va">xpop</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tnt.1"</span>, <span class="st">"tnt.2"</span><span class="op">)</span><span class="op">]</span> <span class="op">|&gt;</span> </span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"tnt"</span>, values_to <span class="op">=</span> <span class="st">"prop"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>tnt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"\\D"</span>, <span class="st">""</span>, <span class="va">tnt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span><span class="fu">postStrat</span><span class="op">(</span>y <span class="op">=</span> <span class="va">xsample</span><span class="op">$</span><span class="va">BA_TPA_ADJ</span>,</span></span>
<span class="r-in"><span>          N <span class="op">=</span> <span class="va">xpop</span><span class="op">$</span><span class="va">npixels</span>,</span></span>
<span class="r-in"><span>          xsample <span class="op">=</span> <span class="va">xsample</span><span class="op">$</span><span class="va">tnt</span>,</span></span>
<span class="r-in"><span>          xpop <span class="op">=</span> <span class="va">pop</span>,</span></span>
<span class="r-in"><span>          datatype <span class="op">=</span> <span class="st">"means"</span>,</span></span>
<span class="r-in"><span>          var_est <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>          var_method <span class="op">=</span> <span class="st">"SRSunconditional"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Assuming simple random sampling</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pop_total</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 40148687</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pop_mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 95.90655</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pop_total_var</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 6.724438e+12</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $pop_mean_var</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 38.37159</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $strat_ests</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 2 × 3</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   x     strat_pop_total strat_pop_mean</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span> 1           35<span style="text-decoration: underline;">004</span>878.          114. </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span> 2            5<span style="text-decoration: underline;">143</span>809.           46.1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $weights</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [1] 0.0006368499 0.0001946594 0.0006368499 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   [6] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [11] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [16] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0006368499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [21] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [26] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0006368499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [31] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [36] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [41] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [46] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [51] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [56] 0.0006368499 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [61] 0.0001946594 0.0001946594 0.0006368499 0.0001946594 0.0006368499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [66] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [71] 0.0006368499 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [76] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0006368499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [81] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [86] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [91] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0006368499</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [96] 0.0001946594 0.0001946594 0.0001946594 0.0001946594 0.0001946594</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span>          </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kelly McConville, Josh Yamamoto, Becky Tang, George Zhu, Grayson White.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

